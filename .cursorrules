# Liftr - Fitness Tracking App - Cursor AI Rules

## Project Context
This is a Next.js fitness tracking application with Turso SQLite database, Redux state management, and Material UI components.

## ğŸ—ï¸ Application Structure

### Directory Organization
```
src/
â”œâ”€â”€ app/                      # Next.js App Router pages
â”‚   â”œâ”€â”€ login/               # Login page
â”‚   â”œâ”€â”€ workouts/            # Workouts management
â”‚   â”œâ”€â”€ training-programs/   # Grouped workouts (training programs)
â”‚   â”œâ”€â”€ users/               # User management (admin)
â”‚   â”œâ”€â”€ progress/            # User progress tracking
â”‚   â”œâ”€â”€ recent/              # Recent workouts
â”‚   â””â”€â”€ api/                 # API routes
â”œâ”€â”€ components/              # Reusable UI components
â”‚   â”œâ”€â”€ common/             # Common components (Loader, etc)
â”‚   â”œâ”€â”€ layout/             # Layout components (Navbar, Sidebar)
â”‚   â””â”€â”€ features/           # Feature-specific components
â”œâ”€â”€ redux/                   # Redux state management
â”‚   â”œâ”€â”€ slices/             # Redux slices
â”‚   â””â”€â”€ store.js            # Redux store configuration
â”œâ”€â”€ services/               # Service layer (modular)
â”‚   â”œâ”€â”€ database/          # Database abstraction
â”‚   â”œâ”€â”€ auth/              # Authentication service
â”‚   â””â”€â”€ api/               # API client utilities
â”œâ”€â”€ lib/                    # Utility libraries
â”œâ”€â”€ constants/             # App-wide constants
â”œâ”€â”€ styles/                # Global styles and theme
â””â”€â”€ types/                 # TypeScript types (if using TS)
```

### File Naming Conventions
- **Components**: PascalCase (e.g., `UserTable.js`)
- **Pages**: lowercase with hyphens (e.g., `training-programs`)
- **Styles**: Match component name (e.g., `UserTable.module.css`)
- **Constants**: UPPER_SNAKE_CASE in files named `constants.js`
- **Services**: camelCase (e.g., `authService.js`)

## ğŸ” Security Guidelines

### 1. No Hardcoded Secrets
- âŒ Never hardcode API keys, tokens, or passwords
- âœ… Always use environment variables from `.env.local`
- âœ… Sensitive values must be in `.env.local` (gitignored)

### 2. Protected Endpoints
- âœ… All API routes must verify JWT token
- âœ… Admin-only routes must check user role
- âœ… Use middleware for route protection

### 3. Password Security
- âœ… Always hash passwords with bcrypt
- âœ… Never log actual passwords
- âœ… Never return passwords in API responses

### 4. SQL Injection Prevention
- âœ… Always use parameterized queries
- âœ… Never concatenate user input into SQL
- âœ… Use `?` placeholders with args array

### 5. XSS Prevention
- âœ… Sanitize user input before rendering
- âœ… Never use dangerouslySetInnerHTML unless necessary

## ğŸ¨ UI/UX Guidelines

### Material UI Standards
- Use Material UI components exclusively
- Follow Material Design principles
- Dark theme as default (can be toggled)
- Responsive design (mobile-first)

### Loading States
- Show Material UI `CircularProgress` or `LinearProgress` for all async operations
- Use consistent loader component from `components/common/Loader.js`
- Display skeleton screens for initial page loads

### Theme Configuration
- Primary Color: Deep blue (#1976d2)
- Dark Mode: Dark background with proper contrast
- Use Material UI's `ThemeProvider`
- Store theme preference in localStorage

## ğŸ“¦ Redux State Management

### Store Structure
```javascript
{
  auth: {
    user: null | User,
    isAuthenticated: boolean,
    loading: boolean,
    error: string | null
  },
  workouts: {
    items: Workout[],
    loading: boolean,
    error: string | null
  },
  trainingPrograms: {
    items: TrainingProgram[],
    loading: boolean,
    error: string | null
  },
  users: {
    items: User[],
    loading: boolean,
    error: string | null
  }
}
```

### Redux Best Practices
- Use Redux Toolkit (createSlice, createAsyncThunk)
- Keep slices small and focused
- Use selectors for derived state
- Handle loading/error states consistently

## ğŸ—„ï¸ Database Schema

**Important**: All Liftr table names must be prefixed with `liftr_`

### Tables
```sql
liftr_users (
  id INTEGER PRIMARY KEY,
  username TEXT UNIQUE,
  password TEXT, -- bcrypt hashed
  name TEXT,
  role TEXT DEFAULT 'user', -- 'user' | 'admin'
  createdAt TEXT,
  lastLogin TEXT
)

liftr_workouts (
  id INTEGER PRIMARY KEY,
  name TEXT,
  equipmentName TEXT,
  equipmentPhoto TEXT, -- URL or base64
  muscleFocus TEXT, -- e.g., 'Chest', 'Legs', 'Back'
  description TEXT,
  createdBy INTEGER, -- user id
  createdAt TEXT
)

liftr_training_programs (
  id INTEGER PRIMARY KEY,
  name TEXT, -- e.g., 'Leg Day', 'Push Day'
  workoutIds TEXT, -- JSON array of workout IDs
  createdBy INTEGER,
  createdAt TEXT
)

liftr_workout_sessions (
  id INTEGER PRIMARY KEY,
  userId INTEGER,
  workoutId INTEGER,
  trainingProgramId INTEGER,
  sets INTEGER,
  reps TEXT, -- JSON array
  weight TEXT, -- JSON array
  duration INTEGER, -- minutes
  notes TEXT,
  completedAt TEXT
)
```

## ğŸ”§ Service Layer (Modular)

### Database Service (`services/database/dbService.js`)
- Abstract database operations
- Easy to swap Turso with other databases
- Export: `query`, `execute`, `transaction`

### Auth Service (`services/auth/authService.js`)
- Handle login, logout, token verification
- Easy to swap JWT with other auth methods
- Export: `login`, `verifyToken`, `hashPassword`, `comparePassword`

### API Client (`services/api/apiClient.js`)
- Centralized API calls
- Handle errors and loading states
- Export: `get`, `post`, `put`, `delete`

## ğŸš« File Creation Rules

### NEVER Create These Files:
- README.md
- CHANGELOG.md
- CONTRIBUTING.md
- LICENSE.md
- SETUP_GUIDE.md
- PROJECT_SUMMARY.md
- QUICK_START.md
- Any .md documentation/instruction files
- .txt summary files
- .sh test script files

### Important:
Documentation and instructions should ONLY be in code comments or inline JSDoc, NEVER in separate .md files.

## ğŸ¯ Feature Requirements

### Login Page
- Username and password fields
- JWT authentication with 3-month expiry
- Store token in httpOnly cookie
- Redirect to home on success

### Navigation
- Navbar with burger menu icon
- Collapsible sidebar with:
  - Workouts
  - Training Programs
  - Users (admin only)
  - My Progress
  - Recent Workouts
- Active route highlighting

### Workouts Page
- Table/Grid view of all workouts
- Add/Edit/Delete functionality
- Fields: Equipment name, photo, muscle focus
- Search and filter options

### Training Programs Page
- Create grouped workouts
- Select multiple workouts
- Name the program (e.g., "Leg Day")
- Assign to users

### Users Page (Admin Only)
- Material UI DataGrid/Table
- Add new user
- Reset password functionality
- Role management

## ğŸ“ Code Quality Rules

### Component Structure
```javascript
// 1. Imports (grouped)
import { useState } from 'react';
import { Button, Box } from '@mui/material';
import { useDispatch } from 'react-redux';
import styles from './Component.module.css';

// 2. Constants
const COMPONENT_CONSTANTS = {};

// 3. Component
export default function Component() {
  // a. Hooks
  // b. State
  // c. Effects
  // d. Handlers
  // e. Render
}
```

### Error Handling
- Always use try/catch for async operations
- Display user-friendly error messages
- Log errors to console in development
- Return appropriate HTTP status codes

### Environment Variables
```bash
# .env.local
TURSO_DATABASE_URL=libsql://liftr_your-db-name.turso.io
TURSO_AUTH_TOKEN=your-turso-token
JWT_SECRET=your-secret-key
JWT_EXPIRY=90d
```

**Important**: All Turso database names must be prefixed with `liftr_`

## ğŸš€ Deployment Checklist

1. âœ… All environment variables set in Vercel
2. âœ… Initialize database tables (`/api/init-db`)
3. âœ… Create admin user
4. âœ… Test authentication flow
5. âœ… Verify responsive design

## âš ï¸ Important Notes

- **JWT Expiry**: 90 days (3 months)
- **Cookie Security**: httpOnly, secure in production
- **Database**: Turso SQLite (but swappable via service layer)
- **State Management**: Redux Toolkit only
- **UI Library**: Material UI only
- **Theme**: Dark mode by default

---

**Remember**: Modularity is key. Every service should be easily replaceable without affecting the rest of the application.
